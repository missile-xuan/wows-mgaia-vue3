function getColor (palette, levels, num) {
  var colors = {
    rainbow: [0.667, 0.0],
    standard: [0.333, 0.0],
    warm: [0.2, 0.0],
    cool: [0.333, 0.667],
    fenyx: [0.5, 0.0]
  }
  return hsl_to_rgb(
    colors[palette][0] +
      (num * (colors[palette][1] - colors[palette][0])) / (levels - 1)
  )
  function hsl_to_rgb (h) {
    return [hue(h + 0.333), hue(h), hue(h - 0.333)]
  }
  function hue (h) {
    if (h < 0) h += 1
    if (h > 1) h -= 1
    if (h * 6 < 1) return h * 6
    if (h * 2 < 1) return 1
    if (h * 3 < 2) return (0.667 - h) * 6
    return 0
  }
}
function openPalette () {
  if (!viewer.scene.background) {
    viewer.scene.background = new THREE.Color(0xffffff)
  }
  var html = '<ul id="palette_list">'
  html +=
    '<li><img class="button palette" src="/images/palette_standard.png" onclick="onPalette(\'standard\');"></li>'
  html +=
    '<li><img class="button palette" src="/images/palette_rainbow.png" onclick="onPalette(\'rainbow\');"></li>'
  html +=
    '<li><img class="button palette" src="/images/palette_cool.png" onclick="onPalette(\'cool\');"></li>'
  html +=
    '<li><img class="button palette" src="/images/palette_warm.png" onclick="onPalette(\'warm\');"></li>'
  html +=
    '<li><img class="button palette" src="/images/palette_fenyx.png" onclick="onPalette(\'fenyx\');"></li>'
  html += '</ul>'
  html += '<hr>'
  html +=
    'Background <input type="color" value="#' +
    viewer.scene.background.getHexString() +
    '" oninput="setBackground(this)" onchange="setBackground(this)">'
  html += '<hr>'
  html +=
    '<span class="flat_button float_right" onclick="ELEMENTS.close(\'palette\')">OK</span>'
  ELEMENTS.open({
    id: 'palette',
    position: {
      x: viewer.mouse.x + 100,
      y: viewer.mouse.y
    },
    caption: 'Palette',
    content: html
  })
}
function onPalette (palette) {
  createColors(palette)
  el = document.getElementById('palette_image')
  el.src = '/images/palette_' + palette + '.png'
  var date = new Date()
  date.setDate(date.getDate() + 180)
  document.cookie =
    'palette=' + palette + '; path=/; expires=' + date.toUTCString()
}
function setBackground (el) {
  viewer.scene.background = new THREE.Color(el.value)
}
